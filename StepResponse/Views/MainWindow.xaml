<Window x:Class="StepResponse.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:StepResponse"
        xmlns:components="clr-namespace:StepResponse.Components"
        xmlns:converters="clr-namespace:StepResponse.Converters"
        xmlns:oxy="clr-namespace:OxyPlot.Wpf;assembly=OxyPlot.Wpf"
        mc:Ignorable="d"
        Title="Step Response"
        Background="#F6F6F6" 
        Height="450"
        Width="800">

    <Window.Resources>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,8,0,4" />
        </Style>
    </Window.Resources>
    
    <Grid Margin="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="340" />
            <ColumnDefinition Width="12" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- LEFT PANEL: Controls -->
        <Border Grid.Column="0" Padding="12" Background="White" CornerRadius="6" BorderBrush="#DDD" BorderThickness="1" >
            <DockPanel LastChildFill="True">
                <StackPanel DockPanel.Dock="Top" Orientation="Vertical">
                    <TextBlock Text="StepResponse" FontSize="20" FontWeight="Bold" Margin="0,0,0,8"/>
                    <TextBlock Text="Simulation controls" Style="{StaticResource SectionHeader}"/>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,4">
                        <TextBlock Text="Sampling time (s):" VerticalAlignment="Center" Width="140"/>
                        <TextBox Text="{Binding SamplingTime, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="120" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,4">
                        <TextBlock Text="Global setpoint:" VerticalAlignment="Center" Width="140"/>
                        <TextBox Text="{Binding GlobalSetpoint, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="120" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <Button Content="Start" Command="{Binding StartCommand}" IsEnabled="{Binding HasSimulators}" Width="80" Margin="0,0,8,0"/>
                        <Button Content="Pause" Command="{Binding StopCommand}" Width="80" />
                        <Button Content="Export" Command="{Binding ExportCommand}" Width="80" Margin="12,0,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0" VerticalAlignment="Center">
                        <TextBlock Text="Simulation time:" Width="140" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SimulationTimeDisplay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                        <TextBlock Text=" s" VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,4,0,8" VerticalAlignment="Center">
                        <TextBlock Text="Samples per model:" Width="140" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SampleCountDisplay}" VerticalAlignment="Center" FontWeight="SemiBold"/>
                    </StackPanel>

                    <Separator Margin="0,6,0,6"/>

                    <DockPanel VerticalAlignment="Center">
                        <Button Content="-" Command="{Binding RemoveSimulatorCommand}"
                                Width="20" Height="20" DockPanel.Dock   ="Right" Margin="5,0,0,0"/>
                        <Button Margin="0" Content="+" Command="{Binding AddSimulatorCommand}" IsEnabled="{Binding Stopped, Mode=OneWay}"
                                Width="20" Height="20" DockPanel.Dock="Right"/>
                        <TextBlock Margin="0" Text="Simulators" Style="{StaticResource SectionHeader}" />
                    </DockPanel>
                </StackPanel>

                <!-- Liste des simulateurs -->
                <ScrollViewer DockPanel.Dock="Bottom" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
                    <ListBox ItemsSource="{Binding Simulators}" 
                             SelectedItem="{Binding SelectedSimulator, Mode=TwoWay}"
                             MouseDoubleClick="ListBox_MouseDoubleClick"
                             HorizontalContentAlignment="Stretch">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <components:SimulatorItemTemplate />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- SPACING COL -->
        <Grid Grid.Column="1" />

        <!-- RIGHT PANEL: Graph / Preview area (empty for now) -->
        <Border Grid.Column="2" Background="White" CornerRadius="6" BorderBrush="#DDD" BorderThickness="1" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,8">
                    <TextBlock Text="Simulation preview" FontSize="14" FontWeight="SemiBold" />
                </StackPanel>

                <!-- Placeholder for graph -->
                <!--<Border Grid.Row="1" Background="#FAFAFA" BorderBrush="#EEE" BorderThickness="1" CornerRadius="4" 
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Margin="0">
                    <Grid>
                        <TextBlock Text="Graphical area — (graph not implemented yet)" Foreground="#AAA" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>
                </Border>-->

                <oxy:PlotView Grid.Row="1" Model="{Binding PlotViewModel.PlotModel}" />
            </Grid>
        </Border>
    </Grid>
</Window>
